<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>心理測驗</title>

  <!-- PWA basics -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="心理測驗">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <style>
      /* ==== Layout-only skin (drop-in) ======================================= */
      /* 字體與色彩變數（可依品牌色調整） */
      :root {
          --bg: #0f172a; /* 背景 */
          --card: #111827; /* 卡片底 */
          --muted: #94a3b8; /* 次要文字 */
          --text: #e5e7eb; /* 主要文字 */
          --line: #1f2937; /* 邊線 */
          --accent: #22d3ee; /* 強調色 */
          --accent-ink: #0b1220; /* 強調按鈕文字底 */
          --radius: 16px; /* 卡片圓角 */
      }

      /* 全局字體與行距（視窗大時微調更舒適） */
      html {
          font-size: 16px;
      }

      @media (min-width: 1024px) {
          html {
              font-size: 17px;
          }
      }

      body {
          background: var(--bg);
          color: var(--text);
          font-family: ui-sans-serif, -apple-system, "Noto Sans TC", "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang TC", "Microsoft JhengHei", sans-serif;
          line-height: 1.6;
      }

      /* 版心：safe 為你的外層容器，讓內容不貼邊、置中 */
      .safe {
          max-width: 960px;
          margin: 0 auto;
          padding: 16px;
          display: flex;
          flex-direction: column;
          min-height: 100dvh;
          gap: 12px;
      }

      /* 頂部列：更清晰的分隔線與內距；捲動時穩固 */
      .topbar {
          position: sticky;
          top: 0;
          z-index: 10;
          background: rgba(15,23,42,.85);
          backdrop-filter: blur(6px);
          border-bottom: 1px solid var(--line);
          padding: 12px 0 !important;
      }

      .topbar__title {
          font-weight: 800;
          letter-spacing: .2px;
      }

      /* 主要內容區：卡片化呈現，保留你的 .app 結構 */
      .app {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 16px;
      }

      .section {
          background: var(--card);
          border: 1px solid var(--line);
          border-radius: var(--radius);
          padding: clamp(16px, 3.2vw, 28px);
      }

      /* 標題層級與間距 */
      h1 {
          font-size: clamp(24px, 3.6vw, 36px);
          line-height: 1.25;
          margin: 0 0 8px;
      }

      h2 {
          font-size: clamp(20px, 2.4vw, 24px);
          line-height: 1.35;
          margin: 0 0 6px;
      }

      h3 {
          font-size: clamp(16px, 2vw, 18px);
          line-height: 1.45;
          margin: 0 0 6px;
      }

      p {
          margin: 6px 0;
          color: var(--text);
      }

      /* 共用格線（若你的題目/選項是多個卡片） */
      .grid, .grid2 {
          display: grid;
          gap: 12px;
      }

      .grid2 {
          grid-template-columns: repeat(2, minmax(0,1fr));
      }

      @media (max-width: 560px) {
          .grid2 {
              grid-template-columns: 1fr;
          }
      }

      /* 選項卡片：不改 HTML 的情況下，盡量涵蓋常見結構 */
      .option, .choice, .card-option, ul.options > li, .list > li {
          list-style: none;
          background: #0b1220;
          border: 1px solid var(--line);
          border-radius: 14px;
          padding: 14px 16px;
          cursor: pointer;
          transition: transform .12s ease, background-color .12s ease, border-color .12s ease;
      }

          .option:hover, .choice:hover, .card-option:hover, ul.options > li:hover, .list > li:hover {
              transform: translateY(-1px);
              border-color: #2b3948;
          }

          .option.selected, .choice.selected, .card-option.selected, ul.options > li.selected, .list > li.selected {
              background: linear-gradient(180deg, #0f1a2a, #0b1220 55%);
              border-color: var(--accent);
              box-shadow: 0 0 0 1px rgba(34,211,238,.25) inset;
          }

      /* 進度與輔助文字 */
      .progress, .hint {
          font-size: .875rem;
          color: var(--muted);
      }

      /* 表單元素（名字/性別等） */
      input[type="text"], input[type="search"], select {
          width: 100%;
          height: 44px;
          border-radius: 12px;
          border: 1px solid var(--line);
          background: #0b1220;
          color: var(--text);
          padding: 0 12px;
          outline: none;
      }

          input[type="text"]:focus, select:focus {
              border-color: #2b3948;
          }

      /* 按鈕：沿用你原本的 .btn，但變得更一致 */
      .btn {
          appearance: none;
          border: 1px solid var(--line);
          background: #0b1220;
          color: var(--text);
          padding: 10px 14px;
          border-radius: 12px;
          font-weight: 600;
          cursor: pointer;
          transition: transform .08s ease, background-color .12s ease, border-color .12s ease;
      }

          .btn:hover {
              transform: translateY(-1px);
              border-color: #2b3948;
          }

          .btn:active {
              transform: translateY(0);
          }

          .btn.primary {
              background: var(--accent);
              color: var(--accent-ink);
              border-color: transparent;
          }

      /* 底部動作列：左右分散、與內容拉開距離 */
      .footer {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 12px;
          margin-top: 8px;
          padding-top: 12px;
          border-top: 1px dashed var(--line);
      }

      /* 空狀態 / 首頁置中區塊（如果你有） */
      .center {
          display: flex;
          align-items: center;
          justify-content: center;
          min-height: 50vh;
          text-align: center;
          flex-direction: column;
          gap: 16px;
      }

      /* 小螢幕的外距與圓角微調 */
      @media (max-width: 480px) {
          .safe {
              padding: 12px;
          }

          :root {
              --radius: 14px;
          }
      }
      /* 全站字體：台灣常見黑體 + 粗體 */
      html, body {
          font-family: ui-sans-serif, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", "Segoe UI", Roboto, Arial, sans-serif;
          font-weight: 700; /* 粗體 */
          color: #fff; /* 文字改白色 */
      }

      /* 讓所有常見元素都吃到白字（避免被原本樣式覆蓋） */
      h1, h2, h3, h4, h5, h6,
      p, span, li, label, small, div,
      button, input, select, textarea {
          color: #fff !important;
          font-weight: 700 !important; /* 粗體 */
      }

      /* 選項常見類名：確保卡片/清單選項是白字 */
      .option, .choice, .card-option, ul.options > li, .list > li {
          color: #fff !important;
          font-weight: 700 !important;
      }

      /* 表單：輸入中的字與 placeholder 都要白色 */
      input, select, textarea {
          color: #fff !important;
          font-weight: 700 !important;
          background-color: transparent; /* 若你是深色背景，避免白底 */
      }

      ::placeholder {
          color: rgba(255,255,255,.6);
      }

      /* 連結顏色（可改你喜歡的亮色） */
      a {
          color: #a5f3fc;
          font-weight: 700;
      }

  </style>
</head>
<body>
  <div class="safe">
    <div class="topbar">
      <div class="topbar__title">心理測驗</div>
      <div>
        <button class="btn" id="btnFullscreen" title="全螢幕">全螢幕</button>
        <button class="btn" id="btnInstall" style="display:none">加入主畫面</button>
      </div>
    </div>

    <div class="app">
      <!-- START: original content from demo.html (body only) -->
<div class="wrap">
  <header>
    <h1></h1>
    <div class="header-right"><button class="btn" id="btnRestart" title="重置">重新開始</button></div>
  </header>
  <main id="stage"><!-- 內容由 JS 注入 --></main>
</div>

<script>
/*************************
 * 題庫（依你的指定）
 *************************/
const AREAS = {
  extrovert: { name: '外向活潑', subs: ['幽默','大方'] },
  introvert: { name: '內向安靜', subs: ['害羞','沉穩'] },
  warm:      { name: '溫暖關懷', subs: ['溫柔','耐心'] },
  strong:    { name: '果斷堅強', subs: ['自信','果斷'] },
  sharp:     { name: '敏銳',     subs: ['聰明','敏銳'] },
};

// 前 5 題：決定五大區域
const Q_MAJOR = [
  { id:1,  text:'題目一', options:[
    {label:'A 果斷堅強', add:'strong'},
    {label:'B 外向活潑', add:'extrovert'},
    {label:'C 敏銳',     add:'sharp'},
    {label:'D 溫暖關懷', add:'warm'},
  ]},
  { id:2,  text:'題目二', options:[
    {label:'A 敏銳',     add:'sharp'},
    {label:'B 內向安靜', add:'introvert'},
    {label:'C 外向活潑', add:'extrovert'},
    {label:'D 溫暖關懷', add:'warm'},
  ]},
  { id:3,  text:'題目三', options:[
    {label:'A 果斷堅強', add:'strong'},
    {label:'B 外向活潑', add:'extrovert'},
    {label:'C 敏銳',     add:'sharp'},
    {label:'D 內向安靜', add:'introvert'},
  ]},
  { id:4,  text:'題目四', options:[
    {label:'A 內向安靜', add:'introvert'},
    {label:'B 溫暖關懷', add:'warm'},
    {label:'C 外向活潑', add:'extrovert'},
    {label:'D 果斷堅強', add:'strong'},
  ]},
  { id:5,  text:'題目五', options:[
    {label:'A 果斷堅強', add:'strong'},
    {label:'B 內向安靜', add:'introvert'},
    {label:'C 敏銳',     add:'sharp'},
    {label:'D 溫暖關懷', add:'warm'},
  ]},
];

// 細分題（每個區域 3 題、兩個選項）
const Q_MINOR = {
  extrovert: [
    { id:6, text:'題目六', options:[{label:'A 幽默', add:'幽默'},{label:'B 大方', add:'大方'}]},
    { id:7, text:'題目七', options:[{label:'A 幽默', add:'幽默'},{label:'B 大方', add:'大方'}]},
    { id:8, text:'題目八', options:[{label:'A 大方', add:'大方'},{label:'B 幽默', add:'幽默'}]},
  ],
  introvert: [
    { id:6, text:'題目六', options:[{label:'A 害羞', add:'害羞'},{label:'B 沉穩', add:'沉穩'}]},
    { id:7, text:'題目七', options:[{label:'A 沉穩', add:'沉穩'},{label:'B 害羞', add:'害羞'}]},
    { id:8, text:'題目八', options:[{label:'A 沉穩', add:'沉穩'},{label:'B 害羞', add:'害羞'}]},
  ],
  warm: [
    { id:6, text:'題目六', options:[{label:'A 溫柔', add:'溫柔'},{label:'B 耐心', add:'耐心'}]},
    { id:7, text:'題目七', options:[{label:'A 溫柔', add:'溫柔'},{label:'B 耐心', add:'耐心'}]},
    { id:8, text:'題目八', options:[{label:'A 溫柔', add:'溫柔'},{label:'B 耐心', add:'耐心'}]},
  ],
  strong: [
    { id:6, text:'題目六', options:[{label:'A 自信', add:'自信'},{label:'B 果斷', add:'果斷'}]},
    { id:7, text:'題目七', options:[{label:'A 自信', add:'自信'},{label:'B 果斷', add:'果斷'}]},
    { id:8, text:'題目八', options:[{label:'A 自信', add:'自信'},{label:'B 果斷', add:'果斷'}]},
  ],
  sharp: [
    { id:6, text:'題目六', options:[{label:'A 聰明', add:'聰明'},{label:'B 敏銳', add:'敏銳'}]},
    { id:7, text:'題目七', options:[{label:'A 敏銳', add:'敏銳'},{label:'B 聰明', add:'聰明'}]},
    { id:8, text:'題目八', options:[{label:'A 敏銳', add:'敏銳'},{label:'B 聰明', add:'聰明'}]},
  ],
};

/*************************
 * 狀態
 *************************/
const stage = document.getElementById('stage');
const btnRestart = document.getElementById('btnRestart');

const state = {
  step: 'home', // home -> profile -> major -> minor -> result
  user: { name:'', gender:'' },
  majorIdx: 0,
  minorIdx: 0,
  majorAnswers: Array(5).fill(null), // 存 add key
  chosenArea: null,
  minorAnswers: Array(3).fill(null), // 存 sub label
};

btnRestart.addEventListener('click', () => resetAll());

function resetAll(){
  state.step = 'home';
  state.user = { name:'', gender:'' };
  state.majorIdx = 0; state.minorIdx = 0;
  state.majorAnswers = Array(5).fill(null);
  state.minorAnswers = Array(3).fill(null);
  state.chosenArea = null;
  render();
}

/*************************
 * UI 渲染
 *************************/
function render(){
  if(state.step==='home') return renderHome();
  if(state.step==='profile') return renderProfile();
  if(state.step==='major') return renderMajor();
  if(state.step==='minor') return renderMinor();
  if(state.step==='result') return renderResult();
}

function renderHome(){
  stage.innerHTML = `
    <div class="center" id="homeCenter" style="flex-direction:column;gap:16px;flex:1;cursor:pointer;">
      <h1 style="margin:0;font-size:36px;font-weight:700;">心理測驗 DEMO</h1>
    </div>
  `;
  const go = ()=>{ state.step='profile'; render(); };
  stage.addEventListener('click', go, { once:true });
}

function renderProfile(){
  stage.innerHTML = `
    <h2>個人資料</h2>
    <div class="grid2" style="margin-top:8px;">
      <div class="field">
        <label>名字</label>
        <input type="text" id="name" placeholder="請輸入名字" value="${escapeHTML(state.user.name)}"/>
      </div>
      <div class="field">
        <label>性別</label>
        <div class="radio">
          <label><input type="radio" name="gender" value="男" ${state.user.gender==='男'?'checked':''}/> 男</label>
          <label><input type="radio" name="gender" value="女" ${state.user.gender==='女'?'checked':''}/> 女</label>
        </div>
      </div>
    </div>
    <div class="footer">
      <button class="btn" id="backHome">← 回首頁</button>
      <button class="btn primary" id="toQ1">前往題目一</button>
    </div>
  `;
  document.getElementById('backHome').addEventListener('click', ()=>{ state.step='home'; render(); });
  document.getElementById('toQ1').addEventListener('click', ()=>{
    const name = document.getElementById('name').value.trim();
    const g = (document.querySelector('input[name=gender]:checked')||{}).value||'';
    state.user = { name, gender:g };
    state.step='major'; state.majorIdx=0; render();
  });
}

function renderMajor(){
  const q = Q_MAJOR[state.majorIdx];
  const selected = state.majorAnswers[state.majorIdx];
  stage.innerHTML = `
    <h2>題目 ${state.majorIdx+1}</h2>
    <h3>${escapeHTML(q.text)}</h3>
    <div class="grid2" id="opts"></div>
    <div class="footer">
      <button class="btn" id="prevBtn">← 上一題</button>
    </div>
  `;
  const opts = document.getElementById('opts');
  q.options.forEach((op)=>{
    const b = document.createElement('button'); b.className='option'; b.textContent = op.label; if(selected===op.add) b.classList.add('selected'); opts.appendChild(b);
    b.addEventListener('click', ()=>{ state.majorAnswers[state.majorIdx] = op.add; autoAdvanceFromMajor(); });
  });
  document.getElementById('prevBtn').addEventListener('click', ()=>{
    if(state.majorIdx>0){ state.majorIdx--; render(); } else { state.step='profile'; render(); }
  });
}

function autoAdvanceFromMajor(){
  if(state.majorIdx<4){ state.majorIdx++; render(); }
  else {
    const counts = tally(state.majorAnswers);
    state.chosenArea = decideArea(counts);
    state.step='minor'; state.minorIdx=0; render();
  }
}

function renderMinor(){
  const arr = Q_MINOR[state.chosenArea];
  const q = arr[state.minorIdx];
  const selected = state.minorAnswers[state.minorIdx];
  stage.innerHTML = `
    <h2>題目 ${state.minorIdx+6}</h2>
    <h3>${escapeHTML(q.text)}</h3>
    <div class="grid2" id="opts"></div>
    <div class="footer">
      <button class="btn" id="prevBtn">← 上一題</button>
    </div>
  `;
  const opts = document.getElementById('opts');
  q.options.forEach((op)=>{
    const b = document.createElement('button'); b.className='option'; b.textContent = op.label; if(selected===op.add) b.classList.add('selected'); opts.appendChild(b);
    b.addEventListener('click', ()=>{ state.minorAnswers[state.minorIdx] = op.add; autoAdvanceFromMinor(); });
  });
  document.getElementById('prevBtn').addEventListener('click', ()=>{
    if(state.minorIdx>0){ state.minorIdx--; render(); }
    else { state.step='major'; state.majorIdx=4; render(); }
  });
}

function autoAdvanceFromMinor(){
  if(state.minorIdx<2){ state.minorIdx++; render(); }
  else { state.step='result'; render(); }
}

function renderResult(){
  const subs = AREAS[state.chosenArea].subs; // [subA, subB]
  const subCounts = tally(state.minorAnswers);
  const finalSub = decideSub(subCounts, subs);
  const gender = state.user.gender||'';
  const resultText = `${finalSub}${gender}`; // 僅顯示「害羞女」結構
  stage.innerHTML = `
    <h2>結果：${escapeHTML(resultText)}</h2>
    <div class="footer" style="justify-content:flex-end;">
      <button class="btn primary" onclick="resetAll()">再測一次</button>
    </div>
  `;
}

/*************************
 * 輔助與邏輯
 *************************/
function tally(arr){
  const map = {};
  arr.forEach(k=>{ if(!k) return; map[k] = (map[k]||0)+1; });
  return map;
}

function decideArea(counts){
  const order = ['extrovert','introvert','warm','strong','sharp'];
  let best = order[0], max = -1;
  for(const k of order){ const v = counts[k]||0; if(v>max){ max=v; best=k; } }
  return best;
}

function decideSub(subCounts, subs){
  const a = subs[0], b = subs[1];
  const sa = subCounts[a]||0, sb = subCounts[b]||0;
  if(sa>sb) return a; if(sb>sa) return b; return a; // 同分取第一個
}

function escapeHTML(s){
  return String(s||'').replace(/[&<>\"]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m]));
}

// 啟動
resetAll();
</script>

      <!-- END: original content -->
    </div>
  </div>

<script>
// Minimal Fullscreen for in-browser runs (PWA installed won't need this)
const fsBtn = document.getElementById('btnFullscreen');
fsBtn?.addEventListener('click', async () => {
  const el = document.documentElement;
  if (el.requestFullscreen) await el.requestFullscreen();
});

// PWA install hint on iOS is manual via "Share > Add to Home Screen".
// We show a helper button on non-iOS supporting beforeinstallprompt (Android/desktop Chromium).
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); deferredPrompt = e;
  const btn = document.getElementById('btnInstall');
  if(btn){ btn.style.display = 'inline-block'; btn.onclick = async () => { deferredPrompt.prompt(); deferredPrompt = null; }; }
});

// Register service worker (optional offline & faster loads)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js');
  });
}
</script>
</body>
</html>
